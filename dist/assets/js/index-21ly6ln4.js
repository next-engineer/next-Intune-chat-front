import{u as e,j as s}from"./index-VwAI4ZKp.js";import{b as t,r as a}from"./vendor-BlUkfZh9.js";import{c as r,S as l,E as i}from"./index-By9Ge4gt.js";import{c as n}from"./button-00Ju-9bM.js";import{M as c}from"./MainLayout-BLWfDej-.js";import{b as d,u as o}from"./router-BuIkA38J.js";import"./error.api-B9wQa4Rf.js";import"./utils-C-1G2k3o.js";import"./endPoint.constants-C9KNCxVz.js";import"./index-DoA_IopH.js";import"./x-DtgjPh_3.js";import"./shield-CvT3rqmd.js";
/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m=n("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),x=n("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),h=n("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),u=n("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),g=n("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),y=n("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),b=n("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),j=t.memo(({message:e,isOwnMessage:t,showAvatar:a})=>{var r;return s.jsx("div",{className:`flex ${t?"justify-end":"justify-start"} mb-3 group`,children:s.jsxs("div",{className:"flex items-end space-x-2 max-w-xs lg:max-w-md "+(t?"flex-row-reverse space-x-reverse":""),children:[a&&!t&&s.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-gray-400 to-gray-500 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx("span",{className:"text-white text-xs font-medium",children:(null==(r=e.senderName)?void 0:r.charAt(0).toUpperCase())||"U"})}),s.jsxs("div",{className:"relative px-4 py-2 rounded-2xl shadow-sm "+(t?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-white text-gray-800 border border-gray-200"),children:[s.jsx("div",{className:"text-sm leading-relaxed",children:e.content}),s.jsx("div",{className:"text-xs mt-1 "+(t?"text-blue-100":"text-gray-400"),children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t&&s.jsx("div",{className:"absolute -bottom-1 -right-1",children:s.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full flex items-center justify-center",children:s.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})})})]})]})})}),f=t.memo(({roomId:t})=>{const[l,i]=a.useState([]),[n,c]=a.useState(null),[d,o]=a.useState(""),[m,u]=a.useState(!1),[b,f]=a.useState(""),[p,v]=a.useState(!1),N=a.useRef(null),w=e(e=>{var s;return null==(s=e.user)?void 0:s.id}),k=()=>{var e;null==(e=N.current)||e.scrollIntoView({behavior:"smooth"})},D=a.useCallback(async()=>{u(!0);try{const e=await r.getChatRoom(t);c(e.room),i(e.messages)}catch(e){f(e.message||"Failed to load chat room")}finally{u(!1)}},[t]),S=a.useCallback(async e=>{if(e.preventDefault(),d.trim())try{const e=await r.sendMessage({roomId:t,content:d});i(s=>[...s,e]),o(""),k()}catch(s){f(s.message||"Failed to send message")}},[d,t]),M=a.useCallback(e=>{o(e.target.value),v(e.target.value.length>0)},[]),C=a.useMemo(()=>[...l].sort((e,s)=>new Date(e.timestamp).getTime()-new Date(s.timestamp).getTime()),[l]),I=a.useMemo(()=>{const e={};return C.forEach(s=>{const t=new Date(s.timestamp).toDateString();e[t]||(e[t]=[]),e[t].push(s)}),e},[C]);return a.useEffect(()=>{D()},[D]),a.useEffect(()=>{k()},[l]),m?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-500",children:"채팅방을 불러오는 중..."})]})}):b?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-red-500 text-4xl mb-4",children:"⚠️"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"오류가 발생했습니다"}),s.jsx("p",{className:"text-gray-600 mb-4",children:b}),s.jsx("button",{onClick:D,className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600",children:"다시 시도"})]})}):s.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:[Object.entries(I).map(([e,t])=>s.jsxs("div",{children:[s.jsx("div",{className:"text-center my-4",children:s.jsx("span",{className:"bg-white px-3 py-1 rounded-full text-xs text-gray-500 shadow-sm",children:new Date(e).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"})})}),t.map((e,a)=>{const r=t[a-1],l=!r||r.senderId!==e.senderId||new Date(e.timestamp).getTime()-new Date(r.timestamp).getTime()>3e5;return s.jsx(j,{message:e,isOwnMessage:e.senderId===w,showAvatar:l},e.id)})]},e)),p&&s.jsx("div",{className:"flex justify-start mb-3",children:s.jsxs("div",{className:"flex items-end space-x-2",children:[s.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-gray-400 to-gray-500 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-white text-xs font-medium",children:"U"})}),s.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl px-4 py-2",children:s.jsxs("div",{className:"flex space-x-1",children:[s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]})}),s.jsx("div",{ref:N})]}),s.jsx("div",{className:"bg-white border-t border-gray-200 p-4",children:s.jsxs("form",{onSubmit:S,className:"flex items-end space-x-3",children:[s.jsxs("div",{className:"flex space-x-1",children:[s.jsx("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:s.jsx(h,{className:"h-5 w-5"})}),s.jsx("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:s.jsx(x,{className:"h-5 w-5"})})]}),s.jsxs("div",{className:"flex-1 relative",children:[s.jsx("input",{type:"text",value:d,onChange:M,placeholder:"메시지를 입력하세요...",className:"w-full border border-gray-300 rounded-2xl px-4 py-3 pr-12 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),s.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(y,{className:"h-5 w-5"})})]}),s.jsx("button",{type:"submit",disabled:!d.trim(),className:"bg-blue-500 text-white p-3 rounded-full hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-lg",children:s.jsx(g,{className:"h-5 w-5"})})]})})]})}),p=()=>{const{roomId:e}=d(),t=o();if(!e)return s.jsx(c,{children:s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"채팅방 오류"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"채팅방 ID가 필요합니다."}),s.jsx("button",{onClick:()=>t("/chat/list"),className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600",children:"채팅 목록으로 돌아가기"})]})})});return s.jsx(c,{children:s.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:s.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:()=>{t("/chat/list")},className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"뒤로가기",children:s.jsx(m,{className:"h-5 w-5 text-gray-600"})}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-white font-semibold text-sm",children:e.charAt(0).toUpperCase()})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"font-semibold text-gray-900",children:["채팅방 ",e]}),s.jsx("p",{className:"text-sm text-gray-500",children:"온라인"})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:s.jsx(l,{className:"h-5 w-5 text-gray-600"})}),s.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:s.jsx(u,{className:"h-5 w-5 text-gray-600"})}),s.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:s.jsx(b,{className:"h-5 w-5 text-gray-600"})}),s.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:s.jsx(i,{className:"h-5 w-5 text-gray-600"})})]})]})}),s.jsx("div",{className:"flex-1 overflow-hidden",children:s.jsx(f,{roomId:e})})]})})};
/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{p as default};
