import{j as e}from"./index-BAGu4OjU.js";import{r as s}from"./vendor-BlUkfZh9.js";import{A as t}from"./endPoint.constants-C9KNCxVz.js";import"./router-BuIkA38J.js";const n=new class{constructor(){this.ws=null,this.pingInterval=null,this.pongTimeout=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.isConnecting=!1,this.sessionId=null,this.stats={totalPings:0,totalPongs:0,averageLatency:0,connectionUptime:0,lastActivity:0},this.connectionStartTime=0,this.connectionStatusCallback=null,this.statsUpdateCallback=null,this.handleMessage=this.handleMessage.bind(this),this.handleClose=this.handleClose.bind(this),this.handleError=this.handleError.bind(this)}async connect(e,s,n){var a;if((null==(a=this.ws)?void 0:a.readyState)!==WebSocket.OPEN&&!this.isConnecting){this.isConnecting=!0,this.sessionId=this.generateSessionId();try{const a=`${t.WEBSOCKET.CONNECT}?userId=${e}&username=${encodeURIComponent(s)}&sessionId=${this.sessionId}`;this.ws=new WebSocket(a),this.ws.onopen=()=>{var e;this.isConnecting=!1,this.reconnectAttempts=0,this.connectionStartTime=Date.now(),this.startPingInterval(n),null==(e=this.connectionStatusCallback)||e.call(this,{isConnected:!0,connectionQuality:"excellent"})},this.ws.onmessage=this.handleMessage,this.ws.onclose=this.handleClose,this.ws.onerror=this.handleError}catch(i){this.isConnecting=!1,this.handleReconnect()}}}disconnect(){var e;this.stopPingInterval(),this.clearPongTimeout(),this.ws&&(this.ws.close(),this.ws=null),this.sessionId=null,this.connectionStartTime=0,null==(e=this.connectionStatusCallback)||e.call(this,{isConnected:!1,connectionQuality:"disconnected"})}startPingInterval(e){this.stopPingInterval();const s=(null==e?void 0:e.pingInterval)||t.WEBSOCKET.PING_INTERVAL;this.pingInterval=window.setInterval(()=>{this.sendPing()},s)}stopPingInterval(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null)}sendPing(){var e;if((null==(e=this.ws)?void 0:e.readyState)===WebSocket.OPEN){const e={type:"ping",userId:this.getUserIdFromUrl(),timestamp:Date.now(),sessionId:this.sessionId||void 0};this.ws.send(JSON.stringify(e)),this.stats.totalPings++,this.stats.lastActivity=Date.now(),this.startPongTimeout(),this.updateStats()}}startPongTimeout(){this.clearPongTimeout(),this.pongTimeout=window.setTimeout(()=>{this.handleReconnect()},t.WEBSOCKET.PONG_TIMEOUT)}clearPongTimeout(){this.pongTimeout&&(clearTimeout(this.pongTimeout),this.pongTimeout=null)}handleMessage(e){try{const s=JSON.parse(e.data);"pong"===s.type&&this.handlePong(s)}catch(s){}}handlePong(e){this.clearPongTimeout(),this.stats.totalPongs++,this.stats.lastActivity=Date.now();const s=Date.now()-e.timestamp;e.responseTime&&(this.stats.averageLatency=(this.stats.averageLatency*(this.stats.totalPongs-1)+s)/this.stats.totalPongs),this.updateStats(),this.updateConnectionQuality(s)}updateConnectionQuality(e){var s;let t="excellent";e>1e3?t="poor":e>500&&(t="good"),null==(s=this.connectionStatusCallback)||s.call(this,{isConnected:!0,lastPingTime:this.stats.lastActivity,lastPongTime:Date.now(),latency:e,connectionQuality:t})}updateStats(){var e;this.connectionStartTime>0&&(this.stats.connectionUptime=Date.now()-this.connectionStartTime),null==(e=this.statsUpdateCallback)||e.call(this,this.stats)}handleClose(e){var s;this.stopPingInterval(),this.clearPongTimeout(),null==(s=this.connectionStatusCallback)||s.call(this,{isConnected:!1,connectionQuality:"disconnected"}),1e3!==e.code&&this.handleReconnect()}handleError(e){var s;null==(s=this.connectionStatusCallback)||s.call(this,{isConnected:!1,connectionQuality:"disconnected"})}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return;this.reconnectAttempts++;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);setTimeout(()=>{var e;if((null==(e=this.ws)?void 0:e.readyState)!==WebSocket.OPEN){const e=this.getUserIdFromUrl(),s=this.getUsernameFromUrl();e&&s&&this.connect(e,s)}},e)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getUserIdFromUrl(){return new URLSearchParams(window.location.search).get("userId")||""}getUsernameFromUrl(){return new URLSearchParams(window.location.search).get("username")||""}onConnectionStatusChange(e){this.connectionStatusCallback=e}onStatsUpdate(e){this.statsUpdateCallback=e}isConnected(){var e;return(null==(e=this.ws)?void 0:e.readyState)===WebSocket.OPEN}getStats(){return{...this.stats}}},a=({connectionStatus:s,stats:t,showStats:n=!1})=>{const a=e=>e?`${e}ms`:"측정 중";return e.jsxs("div",{className:"flex flex-col gap-2 p-3 bg-white rounded-lg shadow-sm border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"연결 상태"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${(e=>{switch(e){case"excellent":return"bg-green-500";case"good":return"bg-yellow-500";case"poor":return"bg-red-500";default:return"bg-gray-400"}})(s.connectionQuality)}`}),e.jsx("span",{className:"text-sm text-gray-600",children:(e=>{switch(e){case"excellent":return"우수";case"good":return"양호";case"poor":return"불량";case"disconnected":return"연결 끊김";default:return"알 수 없음"}})(s.connectionQuality)})]})]}),s.latency&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"응답 시간"}),e.jsx("span",{className:"text-sm text-gray-600",children:a(s.latency)})]}),n&&t&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"핑 전송"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.totalPings,"회"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"퐁 수신"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.totalPongs,"회"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"평균 응답시간"}),e.jsx("span",{className:"text-sm text-gray-600",children:a(t.averageLatency)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"연결 유지시간"}),e.jsx("span",{className:"text-sm text-gray-600",children:(e=>{const s=Math.floor(e/36e5),t=Math.floor(e%36e5/6e4),n=Math.floor(e%6e4/1e3);return s>0?`${s}시간 ${t}분`:t>0?`${t}분 ${n}초`:`${n}초`})(t.connectionUptime)})]})]})})]})},i=({isOnline:s,lastSeen:t,size:n="md"})=>e.jsx("div",{className:"flex items-center gap-2",title:s?"온라인":t?`마지막 활동: ${t.toLocaleString("ko-KR")}`:"오프라인",children:e.jsx("div",{className:`${{sm:"w-2 h-2",md:"w-3 h-3",lg:"w-4 h-4"}[n]} rounded-full ${s?"bg-green-500":"bg-gray-400"}`})}),l={},c=[{id:"test-user-001",name:"김테스터",description:"기본 테스트 유저",avatar:"👨‍💻"},{id:"test-user-002",name:"이개발자",description:"개발자 테스트 유저",avatar:"👩‍💻"},{id:"test-user-003",name:"박디자이너",description:"디자이너 테스트 유저",avatar:"🎨"},{id:"test-user-004",name:"최기획자",description:"기획자 테스트 유저",avatar:"📋"},{id:"test-user-005",name:"정관리자",description:"관리자 테스트 유저",avatar:"👔"},{id:"test-user-006",name:"강운영자",description:"운영자 테스트 유저",avatar:"🔧"},{id:"test-user-007",name:"윤분석가",description:"데이터 분석가 테스트 유저",avatar:"📊"},{id:"test-user-008",name:"임마케터",description:"마케터 테스트 유저",avatar:"📢"}],r=()=>{const[t,r]=s.useState("test-user-001"),[d,o]=s.useState("김테스터"),[m,h]=s.useState(!0),{connectionStatus:x,stats:g,isConnected:u,connectionQuality:p,latency:j}=((e,t,a)=>{const[i,l]=s.useState({isConnected:!1,connectionQuality:"disconnected"}),[c,r]=s.useState({totalPings:0,totalPongs:0,averageLatency:0,connectionUptime:0,lastActivity:0}),d=s.useRef(!1);return s.useEffect(()=>(d.current||(n.onConnectionStatusChange(e=>{l(e)}),n.onStatsUpdate(e=>{r(e)}),n.connect(e,t,a),d.current=!0),()=>{n.disconnect(),d.current=!1}),[e,t,a]),{connectionStatus:i,stats:c,isConnected:i.isConnected,connectionQuality:i.connectionQuality,latency:i.latency}})(t,d,{pingInterval:3e4,pongTimeout:1e4,maxRetries:5,retryDelay:1e3});return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"핑퐁 기능 테스트"}),e.jsx("p",{className:"text-gray-600",children:"AWS WebSocket을 통한 실시간 연결 상태와 핑퐁 통계를 확인할 수 있습니다."})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"가짜 유저 선택"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"다양한 테스트 시나리오를 위한 가짜 유저를 선택하세요."}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:c.map(s=>e.jsxs("button",{onClick:()=>(e=>{r(e.id),o(e.name)})(s),className:"p-4 rounded-lg border-2 transition-all duration-200 hover:shadow-md "+(t===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[e.jsx("div",{className:"text-2xl mb-2",children:s.avatar}),e.jsx("div",{className:"font-semibold text-sm text-gray-900",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.description}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:s.id})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"현재 선택된 사용자"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"사용자 ID"}),e.jsx("input",{type:"text",value:t,onChange:e=>r(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"사용자 ID를 입력하세요"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"사용자명"}),e.jsx("input",{type:"text",value:d,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"사용자명을 입력하세요"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"핑퐁 연결 상태"}),e.jsx(a,{connectionStatus:x,stats:g,showStats:m}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx("button",{onClick:()=>h(!m),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:m?"통계 숨기기":"통계 보기"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"온라인 상태"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"현재 상태:"}),e.jsx(i,{isOnline:u}),e.jsx("span",{className:"text-sm text-gray-600",children:u?"온라인":"오프라인"})]})}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"연결 품질:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["excellent"===p&&"우수","good"===p&&"양호","poor"===p&&"불량","disconnected"===p&&"연결 끊김"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"응답 시간:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:j?`${j}ms`:"측정 중"})]})]})]})]}),m&&g&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"실시간 통계"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.totalPings}),e.jsx("div",{className:"text-sm text-gray-600",children:"핑 전송"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.totalPongs}),e.jsx("div",{className:"text-sm text-gray-600",children:"퐁 수신"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:g.averageLatency>0?`${Math.round(g.averageLatency)}ms`:"0ms"}),e.jsx("div",{className:"text-sm text-gray-600",children:"평균 응답시간"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[Math.floor(g.connectionUptime/1e3),"s"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"연결 유지시간"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"연결 정보"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"WebSocket URL:"}),e.jsx("span",{className:"text-sm text-gray-900 font-mono",children:(null==l?void 0:l.VITE_WEBSOCKET_URL)||"설정되지 않음"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"핑 간격:"}),e.jsx("span",{className:"text-sm text-gray-900",children:"30초"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"퐁 타임아웃:"}),e.jsx("span",{className:"text-sm text-gray-900",children:"10초"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"최대 재시도:"}),e.jsx("span",{className:"text-sm text-gray-900",children:"5회"})]})]})]}),e.jsxs("div",{className:"mt-8 bg-blue-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"사용법"}),e.jsxs("ul",{className:"text-blue-800 space-y-1",children:[e.jsx("li",{children:"• 가짜 유저를 선택하면 자동으로 핑퐁 연결이 시작됩니다."}),e.jsx("li",{children:"• 연결 상태는 실시간으로 업데이트됩니다."}),e.jsx("li",{children:"• 핑/퐁 통계는 연결 유지 시간 동안 누적됩니다."}),e.jsx("li",{children:"• 연결이 끊어지면 자동으로 재연결을 시도합니다."}),e.jsx("li",{children:"• 응답 시간에 따라 연결 품질이 자동으로 평가됩니다."})]})]}),e.jsxs("div",{className:"mt-8 bg-green-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-900 mb-4",children:"테스트 시나리오"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"🎯 기본 연결 테스트"}),e.jsx("p",{className:"text-sm text-green-700",children:"가짜 유저를 선택하여 기본적인 핑퐁 연결을 테스트합니다."})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"🔄 재연결 테스트"}),e.jsx("p",{className:"text-sm text-green-700",children:"네트워크 연결을 끊어서 자동 재연결 기능을 테스트합니다."})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"📊 통계 모니터링"}),e.jsx("p",{className:"text-sm text-green-700",children:"실시간 통계를 통해 연결 품질과 응답 시간을 모니터링합니다."})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"👥 다중 유저 테스트"}),e.jsx("p",{className:"text-sm text-green-700",children:"여러 가짜 유저로 동시 연결을 시뮬레이션합니다."})]})]})]}),e.jsxs("div",{className:"mt-8 bg-purple-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-900 mb-4",children:"가짜 유저 정보"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.map(s=>e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-2xl",children:s.avatar}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-purple-900",children:s.name}),e.jsx("div",{className:"text-xs text-purple-600",children:s.id})]})]}),e.jsx("p",{className:"text-sm text-purple-700",children:s.description})]},s.id))})]}),e.jsxs("div",{className:"mt-8 bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"개발자 정보"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("p",{children:"• 이 페이지는 핑퐁 기능의 개발 및 테스트를 위해 제작되었습니다."}),e.jsx("p",{children:"• 실제 서비스에서는 실제 사용자 인증 시스템을 사용합니다."}),e.jsx("p",{children:"• WebSocket 연결은 AWS 서비스를 통해 관리됩니다."}),e.jsx("p",{children:"• 모든 테스트 데이터는 로컬에서만 사용되며 서버에 저장되지 않습니다."})]})]})]})})};export{r as default};
